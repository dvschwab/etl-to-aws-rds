# Establishing IAM Role-Based Authentication for AWS-hosted Databases

Amazon Web Services (AWS) provides the Relational Database Service (RDS) to procure MySQL and other SQL databases. The RDS service handles typical administrative tasks such as backups and updates, while users interact with the database itself. Together, this natural division of responsibility offloads the time-consuming administrative work to Amazon while providing users with a fully-functional database instance accessible with their pre-existing skill set.

Since the database is fully integrated into the AWS ecosystem, other AWS services can provide additional functionality. Here, we describe how the Identity and Access Management (IAM) service can provide an additional layer of role-based security to control database access. This layer operates separately from standard database security controls such as login/passwords, permissions, and SSL. The benefits are both increased security and additional offloading of access management to AWS.

## Overview

While configuring role-based authentication is not difficult, it does require several steps. Some of these are performed via AWS (either through the Console or the AWS CLI), while others take place in the database proper. There are also preliminary requirements that must be met before role-based security may be procured.

Here is the list of required steps:

* Preliminary
1. Establish database connectivity
2. Secure connection with SSL
* Role-Based Security
1. Enable IAM authentication for database
2. Create policy allowing database access
3. Create IAM user and attach access policy
4. Create database user identified by AWS Authentication
5. Generate authentication token
6. Connect to database with IAM user and token

### Preliminary Steps

Before using role-based authentication, you must be able to connect to the database using standard protocols. In MySQL, this can be done with the MySQL client using the following syntax:

`mysql -h <hostname> -p <port> -u <user> -p <password>`

Here, the *hostname* can be found on the AWS Console at **RDS > Databases > <database-name> > Connectivity & Security**: it will follow the pattern *<database-name>.<unique-id>.<region>.rds.amazonaws.com*. The *user* and *password* are the credentials generated by `CREATE USER`. The *port* may be omitted if the default port 3306 is used. Note that it is more secure to omit the password itself and just add the *-p* option: this invokes a seperate password validation script that masks the password as it is entered, preventing it from appearing in the command history.

To secure the connection with SSL, first download the AWS global certification bundle; as of this writing, the bundle is located at `https://truststore.pki.rds.amazonaws.com/global/global-bundle.pem`. Save this in a convenient location and reference it with additional client options:

`mysql -h <hostname> -p <port> -u <user> -p <password> --ssl-mode=VERIFY_CA --ssl-ca=<certificate path>`

Here, the *VERIFY_CA* option forces the client to verify the AWS certificates with the registered Certificate Authority; without this option, the connection will still be encrypted, but there is no guarantee the certificates themselves have not been compromised. Note that you do not need to generate a key pair for the client machine, as there is no way to modify the RDS instance to use it.

#### Sidebar

After verifying connectivity, you can use the *mysql_config* tool to save the connection parameters as a profile; afterwards, you just need to supply the profile name (and any additional parameters). You can also specify the SSL options in the global configuration file (typically named *my.ini* or *my.conf*) instead of typing them.

### Role-Based Security

**RDS > Databases > <database-name> > Configuration
